/*!
 * w-hc-2-png v1.0.44
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("fs"),require("path"),require("puppeteer"),require("child_process")):"function"==typeof define&&define.amd?define(["fs","path","puppeteer","child_process"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["w-hc-2-png"]=t(e.fs,e.path,e.puppeteer,e.child_process)}(this,function(e,t,r,n){"use strict";var o=Array.isArray,i="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,s=i||c||Function("return this")(),u=s.Symbol,a=Object.prototype,l=a.hasOwnProperty,f=a.toString,p=u?u.toStringTag:void 0;var h=Object.prototype.toString;var d=u?u.toStringTag:void 0;function y(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":d&&d in Object(e)?function(e){var t=l.call(e,p),r=e[p];try{e[p]=void 0;var n=!0}catch(e){}var o=f.call(e);return n&&(t?e[p]=r:delete e[p]),o}(e):function(e){return h.call(e)}(e)}function b(e){return null!=e&&"object"==typeof e}function g(e){return"symbol"==typeof e||b(e)&&"[object Symbol]"==y(e)}var m=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,v=/^\w*$/;function j(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function w(e){if(!j(e))return!1;var t=y(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var _,S=s["__core-js_shared__"],x=(_=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var $=Function.prototype.toString;function O(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var P=/^\[object .+?Constructor\]$/,F=Function.prototype,A=Object.prototype,E=F.toString,T=A.hasOwnProperty,k=RegExp("^"+E.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function H(e){return!(!j(e)||(t=e,x&&x in t))&&(w(e)?k:P).test(O(e));var t}function D(e,t){var r=function(e,t){return null==e?void 0:e[t]}(e,t);return H(r)?r:void 0}var N=D(Object,"create");var z=Object.prototype.hasOwnProperty;var U=Object.prototype.hasOwnProperty;function q(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function C(e,t){return e===t||e!=e&&t!=t}function J(e,t){for(var r=e.length;r--;)if(C(e[r][0],t))return r;return-1}q.prototype.clear=function(){this.__data__=N?N(null):{},this.size=0},q.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},q.prototype.get=function(e){var t=this.__data__;if(N){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return z.call(t,e)?t[e]:void 0},q.prototype.has=function(e){var t=this.__data__;return N?void 0!==t[e]:U.call(t,e)},q.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=N&&void 0===t?"__lodash_hash_undefined__":t,this};var R=Array.prototype.splice;function M(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}M.prototype.clear=function(){this.__data__=[],this.size=0},M.prototype.delete=function(e){var t=this.__data__,r=J(t,e);return!(r<0)&&(r==t.length-1?t.pop():R.call(t,r,1),--this.size,!0)},M.prototype.get=function(e){var t=this.__data__,r=J(t,e);return r<0?void 0:t[r][1]},M.prototype.has=function(e){return J(this.__data__,e)>-1},M.prototype.set=function(e,t){var r=this.__data__,n=J(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var I=D(s,"Map");function B(e,t){var r,n,o=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof t?"string":"hash"]:o.map}function V(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}V.prototype.clear=function(){this.size=0,this.__data__={hash:new q,map:new(I||M),string:new q}},V.prototype.delete=function(e){var t=B(this,e).delete(e);return this.size-=t?1:0,t},V.prototype.get=function(e){return B(this,e).get(e)},V.prototype.has=function(e){return B(this,e).has(e)},V.prototype.set=function(e,t){var r=B(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function L(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var c=e.apply(this,n);return r.cache=i.set(o,c)||i,c};return r.cache=new(L.Cache||V),r}L.Cache=V;var W,Y,G,K=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Q=/\\(\\)?/g,X=(W=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(K,function(e,r,n,o){t.push(n?o.replace(Q,"$1"):r||e)}),t},Y=L(W,function(e){return 500===G.size&&G.clear(),e}),G=Y.cache,Y),Z=X;var ee=u?u.prototype:void 0,te=ee?ee.toString:void 0;function re(e){if("string"==typeof e)return e;if(o(e))return function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}(e,re)+"";if(g(e))return te?te.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ne(e){return null==e?"":re(e)}function oe(e,t){return o(e)?e:function(e,t){if(o(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!g(e))||v.test(e)||!m.test(e)||null!=t&&e in Object(t)}(e,t)?[e]:Z(ne(e))}function ie(e){if("string"==typeof e||g(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function ce(e,t,r){var n=null==e?void 0:function(e,t){for(var r=0,n=(t=oe(t,e)).length;null!=e&&r<n;)e=e[ie(t[r++])];return r&&r==n?e:void 0}(e,t);return void 0===n?r:n}function se(e){return"[object String]"===Object.prototype.toString.call(e)}function ue(e){return!(!se(e)||""===e)}function ae(e){return e!=e}function le(e){let t=!1;if(ue(e))t=!isNaN(Number(e));else if(function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)){if(ae(e))return!1;t=!0}return t}function fe(e){return"[object Object]"===Object.prototype.toString.call(e)}var pe=/\s/;var he=/^\s+/;function de(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&pe.test(e.charAt(t)););return t}(e)+1).replace(he,""):e}var ye=/^[-+]0x[0-9a-f]+$/i,be=/^0b[01]+$/i,ge=/^0o[0-7]+$/i,me=parseInt;function ve(e){if("number"==typeof e)return e;if(g(e))return NaN;if(j(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=j(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=de(e);var r=be.test(e);return r||ge.test(e)?me(e.slice(2),r?2:8):ye.test(e)?NaN:+e}var je=1/0;function we(e){return e?(e=ve(e))===je||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function _e(e){if(!le(e))return 0;return we(e)}function Se(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}var xe,$e=function(e,t,r){for(var n=-1,o=Object(e),i=r(e),c=i.length;c--;){var s=i[xe?c:++n];if(!1===t(o[s],s,o))break}return e},Oe=$e;function Pe(e){return b(e)&&"[object Arguments]"==y(e)}var Fe=Object.prototype,Ae=Fe.hasOwnProperty,Ee=Fe.propertyIsEnumerable,Te=Pe(function(){return arguments}())?Pe:function(e){return b(e)&&Ae.call(e,"callee")&&!Ee.call(e,"callee")},ke=Te;var He="object"==typeof exports&&exports&&!exports.nodeType&&exports,De=He&&"object"==typeof module&&module&&!module.nodeType&&module,Ne=De&&De.exports===He?s.Buffer:void 0,ze=(Ne?Ne.isBuffer:void 0)||function(){return!1},Ue=/^(?:0|[1-9]\d*)$/;function qe(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Ue.test(e))&&e>-1&&e%1==0&&e<t}function Ce(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}var Je={};Je["[object Float32Array]"]=Je["[object Float64Array]"]=Je["[object Int8Array]"]=Je["[object Int16Array]"]=Je["[object Int32Array]"]=Je["[object Uint8Array]"]=Je["[object Uint8ClampedArray]"]=Je["[object Uint16Array]"]=Je["[object Uint32Array]"]=!0,Je["[object Arguments]"]=Je["[object Array]"]=Je["[object ArrayBuffer]"]=Je["[object Boolean]"]=Je["[object DataView]"]=Je["[object Date]"]=Je["[object Error]"]=Je["[object Function]"]=Je["[object Map]"]=Je["[object Number]"]=Je["[object Object]"]=Je["[object RegExp]"]=Je["[object Set]"]=Je["[object String]"]=Je["[object WeakMap]"]=!1;var Re="object"==typeof exports&&exports&&!exports.nodeType&&exports,Me=Re&&"object"==typeof module&&module&&!module.nodeType&&module,Ie=Me&&Me.exports===Re&&i.process,Be=function(){try{var e=Me&&Me.require&&Me.require("util").types;return e||Ie&&Ie.binding&&Ie.binding("util")}catch(e){}}(),Ve=Be&&Be.isTypedArray,Le=Ve?function(e){return function(t){return e(t)}}(Ve):function(e){return b(e)&&Ce(e.length)&&!!Je[y(e)]},We=Le,Ye=Object.prototype.hasOwnProperty;function Ge(e,t){var r=o(e),n=!r&&ke(e),i=!r&&!n&&ze(e),c=!r&&!n&&!i&&We(e),s=r||n||i||c,u=s?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],a=u.length;for(var l in e)!t&&!Ye.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||c&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||qe(l,a))||u.push(l);return u}var Ke=Object.prototype;var Qe=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),Xe=Qe,Ze=Object.prototype.hasOwnProperty;function et(e){if(r=(t=e)&&t.constructor,t!==("function"==typeof r&&r.prototype||Ke))return Xe(e);var t,r,n=[];for(var o in Object(e))Ze.call(e,o)&&"constructor"!=o&&n.push(o);return n}function tt(e){return null!=e&&Ce(e.length)&&!w(e)}function rt(e){return tt(e)?Ge(e):et(e)}var nt=function(e,t){return function(r,n){if(null==r)return r;if(!tt(r))return e(r,n);for(var o=r.length,i=t?o:-1,c=Object(r);(t?i--:++i<o)&&!1!==n(c[i],i,c););return r}}(function(e,t){return e&&Oe(e,t,rt)}),ot=nt;function it(e){return e}function ct(e,t){var r;return(o(e)?Se:ot)(e,"function"==typeof(r=t)?r:it)}var st=D(s,"DataView"),ut=D(s,"Promise"),at=D(s,"Set"),lt=D(s,"WeakMap"),ft="[object Map]",pt="[object Promise]",ht="[object Set]",dt="[object WeakMap]",yt="[object DataView]",bt=O(st),gt=O(I),mt=O(ut),vt=O(at),jt=O(lt),wt=y;(st&&wt(new st(new ArrayBuffer(1)))!=yt||I&&wt(new I)!=ft||ut&&wt(ut.resolve())!=pt||at&&wt(new at)!=ht||lt&&wt(new lt)!=dt)&&(wt=function(e){var t=y(e),r="[object Object]"==t?e.constructor:void 0,n=r?O(r):"";if(n)switch(n){case bt:return yt;case gt:return ft;case mt:return pt;case vt:return ht;case jt:return dt}return t});var _t=wt;var St,xt=(St="length",function(e){return null==e?void 0:e[St]}),$t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Ot="\\ud800-\\udfff",Pt="["+Ot+"]",Ft="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",At="\\ud83c[\\udffb-\\udfff]",Et="[^"+Ot+"]",Tt="(?:\\ud83c[\\udde6-\\uddff]){2}",kt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ht="(?:"+Ft+"|"+At+")"+"?",Dt="[\\ufe0e\\ufe0f]?",Nt=Dt+Ht+("(?:\\u200d(?:"+[Et,Tt,kt].join("|")+")"+Dt+Ht+")*"),zt="(?:"+[Et+Ft+"?",Ft,Tt,kt,Pt].join("|")+")",Ut=RegExp(At+"(?="+At+")|"+zt+Nt,"g");function qt(e){return function(e){return $t.test(e)}(e)?function(e){for(var t=Ut.lastIndex=0;Ut.test(e);)++t;return t}(e):xt(e)}function Ct(e){if(null==e)return 0;if(tt(e))return"string"==typeof(t=e)||!o(t)&&b(t)&&"[object String]"==y(t)?qt(e):e.length;var t,r=_t(e);return"[object Map]"==r||"[object Set]"==r?e.size:et(e).length}function Jt(e){return"[object Array]"===Object.prototype.toString.call(e)}function Rt(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(fe(e)){for(let t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!se(e)||""!==e)}(e)||(!!function(e){return!!Jt(e)&&0===e.length}(e)||!!ae(e)))))}function Mt(e){return!!Jt(e)&&(0!==e.length&&(1!==e.length||!Rt(e[0])))}function It(e){var t=we(e),r=t%1;return t==t?r?t-r:t:0}function Bt(e){return!!le(e)&&(e=_e(e),"number"==typeof(t=e)&&t==It(t));var t}var Vt=s.isFinite,Lt=Math.min;var Wt=function(e){var t=Math[e];return function(e,r){if(e=ve(e),(r=null==r?0:Lt(It(r),292))&&Vt(e)){var n=(ne(e)+"e").split("e");return+((n=(ne(t(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round"),Yt=Wt;function Gt(e){if(!le(e))return 0;e=_e(e);let t=Yt(e);return"0"===String(t)?0:t}function Kt(e){if(!Bt(e))return!1;return Gt(e)>=0}function Qt(e){if(!Bt(e))return!1;return Gt(e)>0}function Xt(e){return!0===(t=e)||!1===t||b(t)&&"[object Boolean]"==y(t);var t}function Zt(e){let t,r=Object.prototype.toString.call(e);if(t="[object Promise]"===r,t)return!0;if("[object Function]"!==r)return!1;try{t="function"!=typeof e.subscribe&&"function"==typeof e.then}catch(e){}return t}const er=[];for(let e=0;e<256;++e)er.push((e+256).toString(16).slice(1));let tr;const rr=new Uint8Array(16);function nr(){if(!tr){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tr=crypto.getRandomValues.bind(crypto)}return tr(rr)}const or={};function ir(e,t,r){let n;if(e)n=cr(e.random??e.rng?.()??nr(),e.msecs,e.seq,t,r);else{const e=Date.now(),o=nr();!function(e,t,r){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(or,e,o),n=cr(o,or.msecs,or.seq,t,r)}return t??function(e,t=0){return(er[e[t+0]]+er[e[t+1]]+er[e[t+2]]+er[e[t+3]]+"-"+er[e[t+4]]+er[e[t+5]]+"-"+er[e[t+6]]+er[e[t+7]]+"-"+er[e[t+8]]+er[e[t+9]]+"-"+er[e[t+10]]+er[e[t+11]]+er[e[t+12]]+er[e[t+13]]+er[e[t+14]]+er[e[t+15]]).toLowerCase()}(n)}function cr(e,t,r,n,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(o<0||o+16>n.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else n=new Uint8Array(16),o=0;return t??=Date.now(),r??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],n[o++]=t/1099511627776&255,n[o++]=t/4294967296&255,n[o++]=t/16777216&255,n[o++]=t/65536&255,n[o++]=t/256&255,n[o++]=255&t,n[o++]=112|r>>>28&15,n[o++]=r>>>20&255,n[o++]=128|r>>>14&63,n[o++]=r>>>6&255,n[o++]=r<<2&255|3&e[10],n[o++]=e[11],n[o++]=e[12],n[o++]=e[13],n[o++]=e[14],n[o++]=e[15],n}function sr(){let e,t,r=new Promise(function(){e=arguments[0],t=arguments[1]});return r.resolve=e,r.reject=t,r}function ur(e=10){le(e)||(e=10);let t=sr();return setTimeout(function(){t.resolve()},e),t}function ar(e,t={}){let r=ce(t,"fs");return!!r.existsSync(e)&&(!r.lstatSync(e).isDirectory()&&!r.lstatSync(e).isSymbolicLink())}function lr(t){return ar(t,{fs:e})}function fr(e,t={}){let r=ce(t,"fs");if(!r.existsSync(e))return!1;let n=r.lstatSync(e);return!n.isFile()&&!n.isSymbolicLink()}function pr(t){return fr(t,{fs:e})}function hr(t){return function(e,t={}){let r=ce(t,"fs");if(fr(e,{fs:r}))return{success:"input folder is already exists: "+e};if(r.existsSync(e))return{error:"input path already exists: "+e};try{r.mkdirSync(e,{recursive:!0})}catch(e){return{error:e}}return{success:"done: "+e}}(t,{fs:e})}function dr(t){return function(e,t={}){let r=ce(t,"fs");if(!r.existsSync(e))return{success:"file does not exist: "+e};if(!ar(e,{fs:r}))return{error:"input path is not a file: "+e};try{r.unlinkSync(e)}catch(e){return{error:e}}return{success:"done: "+e}}(t,{fs:e})}function yr(t){return function(e,t={}){let r=ce(t,"fs");if(!r.existsSync(e))return{success:"folder does not exist: "+e};if(!fr(e,{fs:r}))return{error:"input path is not a folder: "+e};try{r.rmSync(e,{recursive:!0,force:!0})}catch(e){return{error:e}}return{success:"done: "+e}}(t,{fs:e})}async function br(t,r={}){return await async function(e,t={}){let r=ce(t,"numRetry");Qt(r)||(r=5),r=Gt(r);let n=ce(t,"fs",null);if(!n.existsSync(e))return"folder does not exist: "+e;if(!fr(e,{fs:n}))return Promise.reject("input path is not a folder: "+e);for(let t=0;t<r;t++)try{n.rmSync(e,{recursive:!0,force:!0});break}catch(e){if("EBUSY"!==e.code)return Promise.reject(e);await ur(300)}return"done: "+e}(t,{fs:e,...r})}function gr(e){if(!ue(e)&&!le(e)&&!g(e))return"";let t="";try{t=String(e)}catch(e){}try{t=e.toString()}catch(e){}return t}function mr(e){let t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function vr(e,t,r={}){if(!Mt(t)&&!ue(t))throw new Error("args is not an effective array or string");ue(t)&&(t=[t]);let o=ce(r,"mode");"spawn"!==o&&"exec"!==o&&"execFile"!==o&&(o="spawn");let i=ce(r,"cbStdout"),c=ce(r,"cbStderr"),s=ce(r,"codeCmd");ue(s)||(s="utf8");let u=ce(r,"useChcp");Xt(u)||(u=!1);let a=sr(),l="",f="",p=null;if("spawn"===o){let r=(d=1,ue(h=e)&&Kt(d)?0===(d=Gt(d))?"":h.substring(0,d):""),o=function(e,t){if(!ue(e))return"";if(!Kt(t))return"";if(0===(t=Gt(t)))return"";let r=e.length-t;return r<0&&(r=0),e.substring(r,r+t)}(e,1);if('"'===r||'"'===o||"'"===r||"'"===o)throw new Error("prog of spawn doens not need to add quotes");p=n.spawn(e,t,{encoding:s,shell:!1})}else if("exec"===o){let r="";u&&(r="cmd /c chcp 65001>nul &&"),p=n.exec(`${r} ${e} ${t.join(" ")} & exit`,{encoding:s})}else{if("execFile"!==o)throw new Error(`invalid mode[${o}]`);p=n.execFile(e,t,{encoding:s})}var h,d;return p.stdout.on("data",e=>{let t=e.toString().trim();l+=t+"\n",mr(i)&&i(t)}),p.stderr.on("data",e=>{let t=e.toString().trim();f+=t+"\n",mr(c)&&c(t)}),p.on("close",e=>{ue(f)?a.reject(f):a.resolve(l)}),p.on("error",e=>{a.reject(e)}),a}let jr=t.resolve();async function wr(n=700,o=400,i=3,c="",s={}){if("win32"!==process.platform)return Promise.reject("operating system is not windows");if(!le(n))return Promise.reject("width is not a number");if((n=_e(n))<=0)return Promise.reject("width <= 0");if(!le(o))return Promise.reject("height is not a number");if((o=_e(o))<=0)return Promise.reject("height <= 0");if(!le(i))return Promise.reject("scale is not a number");if((i=_e(i))<=0)return Promise.reject("scale <= 0");if(!ue(c))return Promise.reject("html is not an effective string");let u=c,a=ce(s,"modeHeadless");!0!==a&&!1!==a&&"new"!==a&&"shell"!==a&&(a="new");let l=ce(s,"scriptsHead");Mt(l)||(l=[]);let f="";ct(l,e=>{f+=`<script src="${e}"><\/script>\n`});let p=ce(s,"execJsHead");ue(p)&&(p=[p]),Mt(p)||(p=[]);let h="";ct(p,e=>{h+=`<script>${e}<\/script>\n\n`});let d=ce(s,"execJsPost");ue(d)&&(d=[d]),Mt(d)||(d=[]);let y="";ct(d,e=>{y+=`<script>${e}<\/script>\n\n`});let b=`${jr}/node_modules/w-html2png/chrome/`,g=`${jr}/chrome/`;pr(b)&&(g=b);let m=`${`${g}portable/App/Chrome-bin/138.0.7204.97/`}chrome.exe`;if(!lr(m))throw new Error(`invalid fpExe[${m}], need to run postinstall`);let v=m,j=ce(s,"retry");Qt(j)||(j=3),j=Gt(j);let w=ce(s,"writeError");Xt(w)||(w=!1);let _=ce(s,"fdPng");ue(_)||(_="./_convertTemp"),pr(_)||hr(_);let S=ce(s,"fdHtml");ue(S)||(S="./_convertTemp"),pr(S)||hr(S);let x=ce(s,"fdProfile");ue(x)||(x="./_convertTemp"),pr(x)||hr(x);let $=ce(s,"fdErr");ue($)||($="./_convertTemp"),pr($)||hr($);let O=`${ir()}`,P=0,F=async()=>{let c=null,s="";P++;let l=`${O}-${P}`;return await(async()=>{let c=[],s=[],p=async e=>{let n=[],o=t.resolve(x,`profile_${l}`),i={headless:a,slowMo:20,protocolTimeout:6e4,userDataDir:o,args:["--no-sandbox","--incognito","--disable-gpu","--disable-software-rasterizer","--disable-setuid-sandbox","--disable-dev-shm-usage","--disable-sync","--disable-extensions","--disable-default-apps","--disable-features=VizDisplayCompositor","--metrics-recording-only","--mute-audio","--no-first-run","--safebrowsing-disable-auto-update"]};ue(v)&&(i.executablePath=v);let c=null,s=null,u=null;try{c=await r.launch(i),s=c.process(),u=ce(s,"pid","")}catch(e){n.push({anchor:"puppeteer.launch(puppeteerOpt)",err:e})}if(null!==c)try{let t=e(c);Zt(t)&&(t=await t)}catch(e){n.push({anchor:"fun(browser)",err:e})}if(null!==c)try{await c.close()}catch(e){n.push({anchor:"browser.close()",err:e})}Kt(u)&&await async function(e){let t=["/pid",gr(e),"/T","/F"];return await vr("taskkill",t)}(u).catch(()=>{});try{await br(o)}catch(e){n.push({anchor:"fsDeleteFolderSafe(fd)",err:e})}return Ct(n)>0?{state:"error",msg:n}:{state:"success",msg:""}},d="",b=null,g=null,m=null;if(b=await(async r=>{let n=[],o=t.resolve(_,`whpic_${l}.png`),i=t.resolve(S,`whweb_${l}.html`),c='\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>highcharts to png</title>\n\n  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"><\/script>\n\n  <script src="https://cdn.jsdelivr.net/npm/wsemi/dist/wsemi.umd.js"><\/script>\n  <script>\n      let w = wsemi\n  <\/script>\n\n  {cScriptsHead}\n\n  {cExecJsHead}\n\n</head>\n<body style="padding:0; margin:0;">\n\n    <div id="pl">\n        {cHtml}\n    </div>\n\n    {cExecJsPost}\n\n</body>\n</html>\n';c=c.replace("{cHtml}",u),c=c.replace("{cScriptsHead}",f),c=c.replace("{cExecJsHead}",h),c=c.replace("{cExecJsPost}",y);try{e.writeFileSync(i,c,"utf8")}catch(e){n.push({anchor:"fs.writeFileSync(fpHtml, g, 'utf8')",err:e})}if(0===Ct(n))try{let e=r(i,o);Zt(e)&&(e=await e)}catch(e){n.push({anchor:"fun(fpHtml, fpPng)",err:e})}if(lr(i))try{e.unlinkSync(i)}catch(e){}if(lr(o))try{e.unlinkSync(o)}catch(e){}return Ct(n)>0?{state:"error",msg:n}:{state:"success",msg:""}})(async(t,r)=>{if(g=await p(async c=>{m=await(async(e,t)=>{let r=[],n=null;try{n=await e.newPage(),n.setDefaultNavigationTimeout(6e4)}catch(e){r.push({anchor:"browser.newPage()",err:e})}if(null!==n)try{let e=t(n);Zt(e)&&(e=await e)}catch(e){r.push({anchor:"fun(page)",err:e})}if(null!==n)try{await n.close()}catch(e){r.push({anchor:"page.close()",err:e})}return Ct(r)>0?{state:"error",msg:r}:{state:"success",msg:""}})(c,async e=>{let c={x:0,y:0,width:Number(n),height:Number(o),deviceScaleFactor:Number(i)};await e.goto(t,{waitUntil:["domcontentloaded","networkidle2"],timeout:6e4}),await e.setViewport(c),await e.screenshot({path:r,timeout:6e4})}).catch(t=>{w&&e.writeFileSync(`./_err_${l}_supplyPage.json`,t.message,"utf8")})}).catch(t=>{w&&e.writeFileSync(`./_err_${l}_supplyBrowser.json`,t.message,"utf8")}),"error"!==ce(g,"state","")){if(lr(r)){try{d=e.readFileSync(r,{encoding:"base64"})}catch(e){return void s.push({anchor:"fs.readFileSync(fpPng, { encoding: 'base64' })",err:e})}return null}s.push({anchor:"fsIsFile(fpPng)",err:new Error(`no file[${r}]`)})}}).catch(t=>{w&&e.writeFileSync(`./_err_${l}_supplyHtml.json`,t.message,"utf8")}),"error"===ce(b,"state","")&&(c=[...c,...b.msg]),"error"===ce(g,"state","")&&(c=[...c,...g.msg]),"error"===ce(m,"state","")&&(c=[...c,...m.msg]),Ct(s)>0&&(c=[...c,...s]),Ct(c)>0){let r="";if(ct(c,e=>{let t=`${ce(e,"err.message","")} in ${e.anchor}`;r+=t+"\n"}),w){let n=t.resolve($,`err_${l}_all.json`);e.writeFileSync(n,r,"utf8")}return Promise.reject(r)}return ue(d)?d:Promise.reject("b64 is not an effective string")})().then(e=>{s=e}).catch(e=>{c=e}).finally(()=>{let r=t.resolve(S,`whweb_${l}.html`);if(lr(r)&&dr(r),lr(r)&&w){let r=t.resolve($,`err_${l}_fpHtml.json`);e.writeFileSync(r,`can not delete html[whweb_${l}.html}]`,"utf8")}let n=t.resolve(x,`profile_${l}`);if(pr(n)&&yr(n),pr(n)&&w){let r=t.resolve($,`err_${l}_fdUserData.json`);e.writeFileSync(r,`can not delete fdUserData[profile_${l}]`,"utf8")}let o=t.resolve(_,`whpic_${l}.png`);if(lr(o)&&dr(o),lr(o)&&w){let r=t.resolve($,`err_${l}_fpPng.json`);e.writeFileSync(r,`can not delete png[whpic_${l}.png]`,"utf8")}}),{state:null===c?"success":"error",message:c,b64:s}};return await(async()=>{let e=null,t="";for(;;){let r=await F().catch(()=>{});if("success"===ce(r,"state","")){t=r.b64;break}if(P>=j){e=r.message;break}await ur(5e3)}return null!==e?Promise.reject(e):t})()}let _r=e.readFileSync("./node_modules/highcharts/highcharts.js","utf8"),Sr=e.readFileSync("./node_modules/highcharts/highcharts-more.js","utf8"),xr=e.readFileSync("./node_modules/highcharts/modules/stock.js","utf8"),$r=e.readFileSync("./node_modules/highcharts/modules/annotations.js","utf8"),Or=e.readFileSync("./node_modules/highcharts/modules/heatmap.js","utf8"),Pr=e.readFileSync("./node_modules/highcharts/modules/boost.js","utf8"),Fr=e.readFileSync("./node_modules/highcharts/modules/boost-canvas.js","utf8");return async function(e=700,t=400,r=3,n={},o={}){if(!le(e))return Promise.reject("width is not a number");if((e=_e(e))<=0)return Promise.reject("width <= 0");if(!le(t))return Promise.reject("height is not a number");if((t=_e(t))<=0)return Promise.reject("height <= 0");if(!le(r))return Promise.reject("scale is not a number");if((r=_e(r))<=0)return Promise.reject("scale <= 0");if(!function(e){if(fe(e)){for(let t in e)return!0;return!1}return!1}(n)&&!ue(n))return Promise.reject("opt is not an effective object or string");let i=[_r,Sr,xr,$r,Or,Pr,Fr],c="";if(ue(n))c=n;else{c=`let opt=${JSON.stringify(n)};`}let s=`\n\n        ${c}\n\n        if(_.isObject(opt)){\n\n            //強制關閉動畫避免過慢顯示無法截到數據圖\n            _.set(opt, 'chart.animation', false)\n            _.set(opt, 'plotOptions.series.animation', false)\n            // console.log('opt', opt)\n        \n            //plot\n            Highcharts.chart('hc', opt)\n\n        }\n        else{\n            console.log('invalid opt')\n        }\n\n    `;s=[s];let u=`\n\n        <div id="hc" style="width:${e}px; height:${t}px;"></div>\n\n    `,a=ce(o,"execJsHead","");ue(a)&&(a=[a]),a=[...a,...i],o.execJsHead=a;let l=ce(o,"execJsPost","");return ue(l)&&(l=[l]),l=[...l,...s],o.execJsPost=l,await wr(e,t,r,u,o)}});
//# sourceMappingURL=w-hc-2-png.umd.js.map
